<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šå¤œä¸‡ç±ä¿±å¯‚</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", sans-serif;
            overflow: hidden;
            background-color: #000;
            cursor: default;
            position: relative;
            height: 100vh;
        }
        
        /* èƒŒæ™¯å›¾ç‰‡ */
        #background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('ç”Ÿæ—¥èƒŒæ™¯.png');
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 3s ease;
            z-index: 1;
        }
        
        /* äº¤äº’ç‰©å®¹å™¨ */
        #interactive-items {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            opacity: 0;
            transition: opacity 5s ease 4s;
        }
        
        /* äº¤äº’ç‰©é€šç”¨æ ·å¼ */
        .interactive-item {
            position: absolute;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
            transition: transform 0.3s ease;
            border-radius: 10px;
        }
        
        .interactive-item:hover {
            transform: scale(1.05);
        }
        
        /* è¯­éŸ³äº¤äº’ç‰©æ‚¬åœæ•ˆæœ - ä¿®å¤ç‰ˆ */
        .voice-item:hover {
            filter: drop-shadow(0 0 10px rgba(255, 241, 200, 0.8)) !important;
        }
        
        /* è›‹ç³•æ‚¬åœæ•ˆæœ */
        .cake-item:hover {
            filter: drop-shadow(0 0 15px rgba(255, 209, 102, 0.9));
        }
        
        /* è£…é¥°ç‰© */
        .decoration-item {
            position: absolute;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 1;
        }
        
        /* å…·ä½“ä½ç½® - ä¿æŒä½ çš„æ•°å€¼ä¸å˜ï¼Œä½†æ·»åŠ å¯ç‚¹å‡»åŒºåŸŸ */
        #dog {
            width: 1180px;
            height: 1180px;
            top: -16%;
            left: 5%;
            background-image: url('å°ç‹—.png');
            /* ç¡®ä¿å°ç‹—åœ¨ç‚¹å‡»å±‚ */
            z-index: 3;
        }
        
        /* æ·»åŠ å°ç‹—çš„å¯ç‚¹å‡»åŒºåŸŸï¼ˆé€æ˜è¦†ç›–å±‚ï¼‰ */
        #dog-click-area {
            position: absolute;
            width: 300px;      /* å¯ç‚¹å‡»åŒºåŸŸå®½åº¦ */
            height: 300px;     /* å¯ç‚¹å‡»åŒºåŸŸé«˜åº¦ */
            top: 60%;          /* è°ƒæ•´åˆ°å°ç‹—å¯è§éƒ¨åˆ† */
            left: 30%;         /* è°ƒæ•´åˆ°å°ç‹—å¯è§éƒ¨åˆ† */
            background-color: transparent;
            cursor: pointer;
            z-index: 4;
            /* è°ƒè¯•æ—¶å¯è§ï¼Œæ­£å¸¸æ—¶éšè— */
            /* border: 2px dashed rgba(255, 0, 0, 0.3); */
        }
        
        #fire {
            width: 1200px;
            height: 1150px;
            bottom: -17%;
            left: 12%;
            background-image: url('ç¯ç«.png');
            z-index: 2;
        }
        
        #snowman {
            width: 1120px;
            height: 1200px;
            top: 50%;
            right: 55%;
            background-image: url('é›ªäºº.png');
            z-index: 3;
        }
        
        /* æ·»åŠ é›ªäººçš„å¯ç‚¹å‡»åŒºåŸŸ */
        #snowman-click-area {
            position: absolute;
            width: 300px;
            height: 300px;
            top: 30%;
            left: 30%;
            background-color: transparent;
            cursor: pointer;
            z-index: 4;
        }
        
        #cat {
            width: 1520px;
            height: 1500px;
            bottom: -35%;
            right: 3%;
            background-image: url('å°çŒ«.png');
            z-index: 1;
        }
        
        #pig {
            width: 1120px;
            height: 1150px;
            top: -18%;
            left: 45%;
            transform: translateX(-50%);
            background-image: url('å°çŒª.png');
            z-index: 3;
        }
        
        /* æ·»åŠ å°çŒªçš„å¯ç‚¹å‡»åŒºåŸŸ */
        #pig-click-area {
            position: absolute;
            width: 300px;
            height: 300px;
            top: 40%;
            left: 30%;
            background-color: transparent;
            cursor: pointer;
            z-index: 4;
        }
        
        #cake {
            width: 650px;
            height: 600px;
            top: 35.7%;
            left: 33.2%;
            background-image: url('è›‹ç³•1.png');
            z-index: 5; /* è›‹ç³•åœ¨æœ€ä¸Šå±‚ */
        }
        
        #stars {
            width: 300px;
            height: 200px;
            top: 10%;
            right: 5%;
            background-image: url('æ˜Ÿæ˜Ÿ.png');
            z-index: 1;
        }
        
        /* è¿”å›æŒ‰é’® */
        #back-btn {
            position: fixed;
            top: 2px;
            left: 20px;
            width: 360px;
            height: 360px;
            background: url('è¿”å›.png') no-repeat center center;
            background-size: contain;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
            opacity: 0.8;
        }
        
        #back-btn:hover {
            transform: scale(1.1);
            opacity: 1;
        }
        
        /* æç¤ºæ–‡æœ¬ */
        #hint-text {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 18px;
            text-align: center;
            z-index: 3;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 20px;
            opacity: 0;
            transition: opacity 1s ease;
        }
        
        /* éŸ³é¢‘æ’­æ”¾æŒ‡ç¤ºå™¨ */
        .audio-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 25px;
            height: 25px;
            background: rgba(255, 107, 107, 0.9);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 6; /* åœ¨å¯ç‚¹å‡»åŒºåŸŸä¹‹ä¸Š */
        }
        
        /* è›‹ç³•æ ·å¼æŒ‡ç¤ºå™¨ */
        .cake-indicator {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: #FFD166;
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .cake-item:hover .cake-indicator {
            opacity: 0.8;
        }
        
        /* è°ƒè¯•ç”¨è¾¹æ¡† */
        .debug-border {
            border: 1px solid red !important;
        }
        
        /* å¯ç‚¹å‡»åŒºåŸŸè°ƒè¯•æ¨¡å¼ */
        .debug-click-areas .click-area {
            border: 2px dashed rgba(0, 255, 0, 0.5) !important;
            background-color: rgba(0, 255, 0, 0.1) !important;
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯å›¾ç‰‡ -->
    <div id="background"></div>
    
    <!-- äº¤äº’ç‰© -->
    <div id="interactive-items">
        <!-- è£…é¥°ç‰© -->
        <div id="stars" class="decoration-item"></div>
        <div id="cat" class="decoration-item"></div>
        
        <!-- äº¤äº’ç‰© -->
        <div id="dog" class="interactive-item voice-item" title="ç‚¹å‡»å¬å°ç‹—å«">
            <div class="audio-indicator">â™ª</div>
        </div>
        
        <!-- å°ç‹—å¯ç‚¹å‡»åŒºåŸŸ -->
        <div id="dog-click-area" class="click-area" title="ç‚¹å‡»å¬å°ç‹—å«"></div>
        
        <div id="fire" class="interactive-item" title="ç¯ç«"></div>
        
        <div id="snowman" class="interactive-item voice-item" title="ç‚¹å‡»å¬é›ªäººå£°éŸ³">
            <div class="audio-indicator">â™ª</div>
        </div>
        
        <!-- é›ªäººå¯ç‚¹å‡»åŒºåŸŸ -->
        <div id="snowman-click-area" class="click-area" title="ç‚¹å‡»å¬é›ªäººå£°éŸ³"></div>
        
        <div id="pig" class="interactive-item voice-item" title="ç‚¹å‡»">
            <div class="audio-indicator">â™ª</div>
        </div>
        
        <!-- å°çŒªå¯ç‚¹å‡»åŒºåŸŸ -->
        <div id="pig-click-area" class="click-area" title="ç‚¹å‡»"></div>
        
        <div id="cake" class="interactive-item cake-item" title="ç‚¹å‡»åˆ‡æ¢è›‹ç³•æ ·å¼">
            <div class="cake-indicator">æ ·å¼ 1/4</div>
        </div>
    </div>
    
    <!-- è¿”å›æŒ‰é’® -->
    <div id="back-btn" title="è¿”å›ä¸Šä¸€é¡µ"></div>
    
    <!-- æç¤ºæ–‡æœ¬ -->
    <div id="hint-text">ç‚¹å‡»ä»»æ„ä½ç½®å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹</div>
    
    <script>
        // ========== å…¨å±€å˜é‡ ==========
        let bgmStarted = false;
        let bgmAudio = null;
        let currentCakeStyle = 1;
        const totalCakeStyles = 4;
        
        // éŸ³é¢‘æ–‡ä»¶æ˜ å°„
        const audioFiles = {
            dog: 'å°ç‹—éŸ³é¢‘.mp3',
            snowman: 'é›ªäººéŸ³é¢‘.mp3',
            pig: 'å°ç‹—éŸ³é¢‘.mp3',
            bgm: 'BGM.mp3'
        };
        
        // è›‹ç³•å›¾ç‰‡æ˜ å°„
        const cakeImages = {
            1: 'è›‹ç³•1.png',
            2: 'è›‹ç³•2.png',
            3: 'è›‹ç³•3.png',
            4: 'è›‹ç³•4.png'
        };
        
        // ========== DOMå…ƒç´  ==========
        const background = document.getElementById('background');
        const interactiveItems = document.getElementById('interactive-items');
        const backBtn = document.getElementById('back-btn');
        const hintText = document.getElementById('hint-text');
        const cakeElement = document.getElementById('cake');
        const cakeIndicator = document.querySelector('.cake-indicator');
        
        // ========== åˆå§‹åŒ– ==========
        function init() {
            console.log('ç¬¬å…­é¡µåˆå§‹åŒ– - ä¿ç•™ä½ çš„å¸ƒå±€æ•°å€¼');
            
            // æ·¡å…¥èƒŒæ™¯
            setTimeout(() => {
                background.style.opacity = '1';
                
                // æ·¡å…¥äº¤äº’ç‰©
                setTimeout(() => {
                    interactiveItems.style.opacity = '1';
                    hintText.style.opacity = '1';
                    
                    // æ£€æŸ¥å…ƒç´ ä½ç½®
                    setTimeout(() => {
                        console.log('=== ä½ çš„å¸ƒå±€æ•°å€¼ ===');
                        console.log('å°ç‹—: top: -16%, left: 5%');
                        console.log('é›ªäºº: top: 50%, right: 55%');
                        console.log('å°çŒª: top: -18%, left: 45%');
                        console.log('è›‹ç³•: top: 35.7%, left: 33.2%');
                        
                        checkElementVisibility();
                    }, 300);
                }, 1000);
            }, 500);
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // é¢„åŠ è½½éŸ³é¢‘
            preloadAudio();
        }
        
        // ========== è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ ==========
        function setupEventListeners() {
            // è¿”å›æŒ‰é’®
            backBtn.addEventListener('click', () => {
                stopBGM();
                window.location.href = 'page5.html';
            });
            
            // ç‚¹å‡»ä»»æ„ä½ç½®æ’­æ”¾BGM
            document.addEventListener('click', (e) => {
                // æ’é™¤äº¤äº’ç‰©ã€å¯ç‚¹å‡»åŒºåŸŸå’Œè¿”å›æŒ‰é’®çš„ç‚¹å‡»
                if (e.target.closest('.interactive-item') ||
                    e.target.closest('.click-area') ||
                    e.target.closest('#back-btn') ||
                    e.target.closest('#hint-text')) {
                    return;
                }
                
                if (!bgmStarted) {
                    startBGM();
                }
            });
            
            // ä¸ºå¯ç‚¹å‡»åŒºåŸŸæ·»åŠ äº‹ä»¶
            document.getElementById('dog-click-area').addEventListener('click', (e) => {
                e.stopPropagation();
                console.log('é€šè¿‡å¯ç‚¹å‡»åŒºåŸŸç‚¹å‡»äº†å°ç‹—');
                playVoice('dog');
            });
            
            document.getElementById('snowman-click-area').addEventListener('click', (e) => {
                e.stopPropagation();
                console.log('é€šè¿‡å¯ç‚¹å‡»åŒºåŸŸç‚¹å‡»äº†é›ªäºº');
                playVoice('snowman');
            });
            
            document.getElementById('pig-click-area').addEventListener('click', (e) => {
                e.stopPropagation();
                console.log('é€šè¿‡å¯ç‚¹å‡»åŒºåŸŸç‚¹å‡»äº†å°çŒª');
                playVoice('pig');
            });
            
            // è›‹ç³•ç‚¹å‡»äº‹ä»¶ï¼ˆç›´æ¥ä½¿ç”¨è›‹ç³•å…ƒç´ ï¼‰
            cakeElement.addEventListener('click', (e) => {
                e.stopPropagation();
                changeCakeStyle();
            });
            
            // ç¯ç«ç‚¹å‡»äº‹ä»¶ï¼ˆå¯é€‰ï¼‰
            document.getElementById('fire').addEventListener('click', (e) => {
                e.stopPropagation();
                console.log('ç¯ç«è¢«ç‚¹å‡»');
            });
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', (e) => {
                // ESCè¿”å›ä¸Šä¸€é¡µ
                if (e.key === 'Escape') {
                    stopBGM();
                    window.location.href = 'page5.html';
                }
                
                // ç©ºæ ¼æ’­æ”¾/æš‚åœBGM
                if (e.key === ' ') {
                    e.preventDefault();
                    if (bgmStarted && bgmAudio) {
                        if (bgmAudio.paused) {
                            bgmAudio.play();
                        } else {
                            bgmAudio.pause();
                        }
                    } else {
                        startBGM();
                    }
                }
                
                // æ•°å­—é”®1-3æ’­æ”¾å¯¹åº”è¯­éŸ³
                if (e.key >= '1' && e.key <= '3') {
                    const items = ['dog', 'snowman', 'pig'];
                    const index = parseInt(e.key) - 1;
                    if (items[index]) {
                        playVoice(items[index]);
                    }
                }
                
                // Cé”®åˆ‡æ¢è›‹ç³•æ ·å¼
                if (e.key === 'c' || e.key === 'C') {
                    changeCakeStyle();
                }
                
                // Dé”®ï¼šè°ƒè¯•æ¨¡å¼ï¼ˆæ˜¾ç¤ºè¾¹æ¡†ï¼‰
                if (e.key === 'd' || e.key === 'D') {
                    e.preventDefault();
                    const items = document.querySelectorAll('.interactive-item, .decoration-item');
                    items.forEach(item => {
                        item.classList.toggle('debug-border');
                    });
                    console.log('è°ƒè¯•è¾¹æ¡†æ¨¡å¼å·²åˆ‡æ¢');
                }
                
                // Pé”®ï¼šæ£€æŸ¥å…ƒç´ ä½ç½®å’Œå¯è§æ€§
                if (e.key === 'p' || e.key === 'P') {
                    e.preventDefault();
                    checkElementVisibility();
                }
                
                // Aé”®ï¼šæ˜¾ç¤º/éšè—å¯ç‚¹å‡»åŒºåŸŸ
                if (e.key === 'a' || e.key === 'A') {
                    e.preventDefault();
                    document.body.classList.toggle('debug-click-areas');
                    console.log('å¯ç‚¹å‡»åŒºåŸŸè°ƒè¯•æ¨¡å¼å·²åˆ‡æ¢');
                }
                
                // Té”®ï¼šæµ‹è¯•éŸ³é¢‘
                if (e.key === 't' || e.key === 'T') {
                    e.preventDefault();
                    console.log('=== æµ‹è¯•å°ç‹—éŸ³é¢‘ ===');
                    playVoice('dog');
                }
            });
        }
        
        // ========== æ£€æŸ¥å…ƒç´ å¯è§æ€§ ==========
        function checkElementVisibility() {
            console.log('=== å…ƒç´ å¯è§æ€§æ£€æŸ¥ ===');
            console.log('çª—å£å°ºå¯¸:', window.innerWidth, 'x', window.innerHeight);
            
            const items = [
                {id: 'dog', name: 'å°ç‹—'},
                {id: 'snowman', name: 'é›ªäºº'}, 
                {id: 'pig', name: 'å°çŒª'},
                {id: 'cake', name: 'è›‹ç³•'}
            ];
            
            items.forEach(item => {
                const element = document.getElementById(item.id);
                if (element) {
                    const rect = element.getBoundingClientRect();
                    const isVisible = rect.top < window.innerHeight && 
                                    rect.bottom > 0 && 
                                    rect.left < window.innerWidth && 
                                    rect.right > 0;
                    
                    console.log(`${item.name} (${item.id}):`);
                    console.log(`  ä½ç½®: top=${Math.round(rect.top)}px, left=${Math.round(rect.left)}px`);
                    console.log(`  å°ºå¯¸: ${Math.round(rect.width)}x${Math.round(rect.height)}px`);
                    console.log(`  å¯è§æ€§: ${isVisible ? 'âœ… å¯è§' : 'âŒ ä¸å¯è§'}`);
                    
                    if (!isVisible) {
                        console.log(`  ğŸ’¡ å·²æ·»åŠ å¯ç‚¹å‡»åŒºåŸŸç¡®ä¿åŠŸèƒ½æ­£å¸¸`);
                    }
                }
            });
        }
        
        // ========== éŸ³é¢‘åŠŸèƒ½ ==========
        function preloadAudio() {
            console.log('å¼€å§‹é¢„åŠ è½½éŸ³é¢‘...');
            
            Object.entries(audioFiles).forEach(([key, file]) => {
                console.log(`é¢„åŠ è½½: ${key} -> ${file}`);
                try {
                    const audio = new Audio();
                    audio.preload = 'auto';
                    audio.src = file;
                    audio.load();
                } catch (error) {
                    console.log(`éŸ³é¢‘é¢„åŠ è½½é”™è¯¯:`, error);
                }
            });
        }
        
        function startBGM() {
            if (bgmStarted) return;
            
            try {
                bgmAudio = new Audio(audioFiles.bgm);
                bgmAudio.loop = true;
                bgmAudio.volume = 0.5;
                
                bgmAudio.play().then(() => {
                    bgmStarted = true;
                    hintText.textContent = 'èƒŒæ™¯éŸ³ä¹æ’­æ”¾ä¸­...';
                    hintText.style.opacity = '0.5';
                    console.log('BGMå¼€å§‹æ’­æ”¾');
                }).catch(error => {
                    console.log('BGMæ’­æ”¾å¤±è´¥:', error);
                    hintText.textContent = 'ç‚¹å‡»æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆå¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’ï¼‰';
                });
            } catch (error) {
                console.error('BGMåŠ è½½å¤±è´¥:', error);
            }
        }
        
        function stopBGM() {
            if (bgmAudio) {
                bgmAudio.pause();
                bgmAudio.currentTime = 0;
                bgmStarted = false;
                console.log('BGMå·²åœæ­¢');
            }
        }
        
        function playVoice(itemId) {
            console.log('æ’­æ”¾è¯­éŸ³:', itemId);
            
            const soundFile = audioFiles[itemId];
            if (!soundFile) {
                console.log('æœªæ‰¾åˆ°éŸ³é¢‘æ–‡ä»¶:', itemId);
                return;
            }
            
            // æ˜¾ç¤ºéŸ³é¢‘æŒ‡ç¤ºå™¨
            const element = document.getElementById(itemId);
            if (element) {
                const indicator = element.querySelector('.audio-indicator');
                if (indicator) {
                    indicator.style.opacity = '1';
                    setTimeout(() => {
                        indicator.style.opacity = '0';
                    }, 1000);
                }
            }
            
            // æ’­æ”¾éŸ³é¢‘
            try {
                const audio = new Audio(soundFile);
                audio.volume = 0.8;
                audio.play().catch(error => {
                    console.log('è¯­éŸ³æ’­æ”¾å¤±è´¥:', error);
                });
            } catch (error) {
                console.error('è¯­éŸ³åŠ è½½å¤±è´¥:', error);
            }
        }
        
        // ========== è›‹ç³•æ ·å¼åˆ‡æ¢ ==========
        function changeCakeStyle() {
            currentCakeStyle = currentCakeStyle % totalCakeStyles + 1;
            
            // æ›´æ–°è›‹ç³•å›¾ç‰‡
            const newImage = cakeImages[currentCakeStyle];
            cakeElement.style.backgroundImage = `url('${newImage}')`;
            
            // æ›´æ–°æŒ‡ç¤ºå™¨æ–‡æœ¬
            cakeIndicator.textContent = `æ ·å¼ ${currentCakeStyle}/${totalCakeStyles}`;
            
            console.log('åˆ‡æ¢è›‹ç³•æ ·å¼:', currentCakeStyle);
            
            // æ˜¾ç¤ºæŒ‡ç¤ºå™¨
            cakeIndicator.style.opacity = '0.8';
            setTimeout(() => {
                cakeIndicator.style.opacity = '0';
            }, 1500);
        }
        
        // ========== é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', init);
        
        // ========== é¡µé¢å¸è½½å‰åœæ­¢BGM ==========
        window.addEventListener('beforeunload', () => {
            stopBGM();
        });
    </script>
</body>
</html>